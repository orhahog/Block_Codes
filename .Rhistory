scale_color_brewer(palette = "Set2", direction = -1) +
labs(x = "Date", y = "Doses", color = " ") +
theme_minimal() +
theme(legend.position = "bottom") +
scale_color_discrete(name = "", labels = c("Daily Doses","7-day rolling average")) +
ylim(0L, 170000L)
doses[DATE >= ymd("20210501")] |>
select("DATE", "NET", "NET7") |>
melt(id.var = "DATE") |>
ggplot(aes(x = DATE, y = value, color = variable)) +
geom_line(size = 1) +
# scale_color_brewer(palette = "Set2", direction = -1) +
labs(x = "Date", y = "Doses", color = " ") +
theme_minimal() +
theme(legend.position = "bottom") +
scale_color_discrete(name = "", labels = c("Daily Doses","7-day rolling average")) +
ylim(0L, 170000L)
doses[DATE >= ymd("20210501")] |>
select("DATE", "NET", "NET7") |>
melt(id.var = "DATE") |>
ggplot(aes(x = DATE, y = value, color = variable)) +
geom_line(size = 1) +
# scale_color_brewer(palette = "Set2", direction = -1) +
labs(x = "Date", y = "Doses", color = " ") +
theme_minimal() +
theme(legend.position = "bottom") +
scale_color_discrete(name = "", labels = c("Daily doses","7-day rolling average")) +
ylim(0L, 170000L)
doses[DATE >= ymd("20210501")] |>
select("DATE", "NET", "NET7") |>
melt(id.var = "DATE") |>
ggplot(aes(x = DATE, y = value, color = variable)) +
geom_line(size = 1) +
# scale_color_brewer(palette = "Set2", direction = -1) +
labs(x = "Date", y = "Doses", color = " ") +
theme_minimal() +
theme(legend.position = "bottom") +
scale_color_discrete(name = "",
values = c("#d8b365", "#5ab4ac"),
labels = c("Daily doses","7-day rolling average")) +
ylim(0L, 170000L)
doses[DATE >= ymd("20210501")] |>
select("DATE", "NET", "NET7") |>
melt(id.var = "DATE") |>
ggplot(aes(x = DATE, y = value, color = variable)) +
geom_line(size = 1) +
# scale_color_brewer(palette = "Set2", direction = -1) +
labs(x = "Date", y = "Doses", color = " ") +
theme_minimal() +
theme(legend.position = "bottom") +
scale_color_discrete(name = "",
labels = c("Daily doses","7-day rolling average")) +
ylim(0L, 170000L)
require(viridis)
doses[DATE >= ymd("20210501")] |>
select("DATE", "NET", "NET7") |>
melt(id.var = "DATE") |>
ggplot(aes(x = DATE, y = value, color = variable)) +
geom_line(size = 1) +
# scale_color_brewer(palette = "Set2", direction = -1) +
labs(x = "Date", y = "Doses", color = " ") +
theme_minimal() +
theme(legend.position = "bottom") +
scale_color_viridis(name = "",
labels = c("Daily doses","7-day rolling average")) +
ylim(0L, 170000L)
doses[DATE >= ymd("20210501")] |>
select("DATE", "NET", "NET7") |>
melt(id.var = "DATE") |>
ggplot(aes(x = DATE, y = value, color = variable)) +
geom_line(size = 1) +
# scale_color_brewer(palette = "Set2", direction = -1) +
labs(x = "Date", y = "Doses", color = " ") +
theme_minimal() +
theme(legend.position = "bottom") +
scale_color_viridis_d(name = "",
labels = c("Daily doses","7-day rolling average")) +
ylim(0L, 170000L)
doses[DATE >= ymd("20210501")] |>
select("DATE", "NET", "NET7") |>
melt(id.var = "DATE") |>
ggplot(aes(x = DATE, y = value, color = variable)) +
geom_line(size = 1) +
# scale_color_brewer(palette = "Set2", direction = -1) +
labs(x = "Date", y = "Doses", color = " ") +
theme_minimal() +
theme(legend.position = "bottom") +
scale_color_brewer(name = "",  palette = "Set2",
labels = c("Daily doses","7-day rolling average")) +
ylim(0L, 170000L)
ggthemr("dust")
library(ggplot2)
require(viridis)
doses[DATE >= ymd("20210501")] |>
select("DATE", "NET", "NET7") |>
melt(id.var = "DATE") |>
ggplot(aes(x = DATE, y = value, color = variable)) +
geom_line(size = 1) +
# scale_color_brewer(palette = "Set2", direction = -1) +
labs(x = "Date", y = "Doses", color = " ") +
theme_minimal() +
theme(legend.position = "bottom") +
scale_color_brewer(name = "",  palette = "Set2",
labels = c("Daily doses","7-day rolling average")) +
ylim(0L, 170000L)
doses[DATE >= ymd("20210501")] |>
select("DATE", "NET", "NET7") |>
melt(id.var = "DATE") |>
ggplot(aes(x = DATE, y = value, color = variable)) +
geom_line(size = 1) +
# scale_color_brewer(palette = "Set2", direction = -1) +
labs(x = "Date", y = "Doses", color = " ") +
theme(legend.position = "bottom") +
scale_color_brewer(name = "",  palette = "Set2",
labels = c("Daily doses","7-day rolling average")) +
ylim(0L, 170000L)
ggthemr("dust")
library(ggplot2)
require(viridis)
doses[DATE >= ymd("20210501")] |>
select("DATE", "NET", "NET7") |>
melt(id.var = "DATE") |>
ggplot(aes(x = DATE, y = value, color = variable)) +
geom_line(size = 1) +
# scale_color_brewer(palette = "Set2", direction = -1) +
labs(x = "Date", y = "Doses", color = " ") +
theme(legend.position = "bottom") +
scale_color_brewer(name = "",  palette = "Set2",
labels = c("Daily doses","7-day rolling average")) +
ylim(0L, 170000L)
doses[DATE >= ymd("20210601")] |>
select("DATE", "NET", "NET7") |>
melt(id.var = "DATE") |>
ggplot(aes(x = DATE, y = value, color = variable)) +
geom_line(size = 1) +
labs(x = "Date", y = "Doses", color = " ") +
theme(legend.position = "bottom") +
scale_color_brewer(name = "",  palette = "Set2",
labels = c("Daily doses","7-day rolling average")) +
ylim(0L, 170000L)
doses[DATE >= ymd("20210701")] |>
select("DATE", "NET", "NET7") |>
melt(id.var = "DATE") |>
ggplot(aes(x = DATE, y = value, color = variable)) +
geom_line(size = 1) +
labs(x = "Date", y = "Doses", color = " ") +
theme(legend.position = "bottom") +
scale_color_brewer(name = "",  palette = "Set2",
labels = c("Daily doses","7-day rolling average")) +
ylim(0L, 170000L)
doses[DATE >= ymd("20210501")] |>
select("DATE", "NET", "NET7") |>
melt(id.var = "DATE") |>
ggplot(aes(x = DATE, y = value, color = variable)) +
geom_line(size = 1) +
labs(x = "Date", y = "Doses", color = " ") +
theme(legend.position = "bottom") +
scale_color_brewer(name = "",  palette = "Set2",
labels = c("Daily doses","7-day rolling average")) +
ylim(0L, 170000L)
require(ggplot2)
require(rvest)
require(data.table)
require(lubridate)
require(ggplot2)
require(ggthemr)
doses <- "https://covidlive.com.au/report/daily-vaccinations/aus" |>
read_html() |>
html_table()
doses <- doses[[2]] |>
data.table()
doses[, `:=`(DATE = dmy(DATE), DOSES = as.numeric(gsub(",", "", DOSES)), NET = as.numeric(gsub(",", "", NET)))]
setkey(doses, DATE)
doses[, DOSES7 := frollmean(DOSES, 7, algo = "exact")]
doses[, NET7 := frollmean(NET, 7, algo = "exact")]
### set theme
ggthemr("dust")
doses[DATE >= ymd("20210501")] |>
select("DATE", "NET", "NET7") |>
melt(id.var = "DATE") |>
ggplot(aes(x = DATE, y = value, color = variable)) +
geom_line(size = 1) +
labs(x = "Date", y = "Doses", color = " ") +
theme(legend.position = "bottom") +
scale_color_brewer(name = "",  palette = "Set2",
labels = c("Daily doses","7-day rolling average")) +
ylim(0L, 170000L)
### set theme
ggthemr("dust")
doses[DATE >= ymd("20210501")] |>
select("DATE", "NET", "NET7") |>
melt(id.var = "DATE") |>
ggplot(aes(x = DATE, y = value, color = variable)) +
geom_line(size = 1) +
labs(x = "Date", y = "Doses", color = " ") +
theme(legend.position = "bottom") +
scale_color_brewer(name = "",  #palette = "Set2",
labels = c("Daily doses","7-day rolling average")) +
ylim(0L, 170000L)
### set theme
ggthemr("dust")
doses[DATE >= ymd("20210501")] |>
select("DATE", "NET", "NET7") |>
melt(id.var = "DATE") |>
ggplot(aes(x = DATE, y = value, color = variable)) +
geom_line(size = 1) +
labs(x = "Date", y = "Doses", color = " ") +
theme(legend.position = "bottom") +
scale_color_brewer(name = "", palette = "Set2",
labels = c("Daily doses","7-day rolling average")) +
ylim(0L, 170000L)
### set theme
ggthemr("earth")
doses[DATE >= ymd("20210501")] |>
select("DATE", "NET", "NET7") |>
melt(id.var = "DATE") |>
ggplot(aes(x = DATE, y = value, color = variable)) +
geom_line(size = 1) +
labs(x = "Date", y = "Doses", color = " ") +
theme(legend.position = "bottom") +
scale_color_brewer(name = "", palette = "Set2",
labels = c("Daily doses","7-day rolling average")) +
ylim(0L, 170000L)
### set theme
ggthemr("dust")
doses[DATE >= ymd("20210501")] |>
select("DATE", "NET", "NET7") |>
melt(id.var = "DATE") |>
ggplot(aes(x = DATE, y = value, color = variable)) +
geom_line(size = 1) +
labs(x = "Date", y = "Doses", color = " ") +
theme(legend.position = "bottom") +
scale_color_brewer(name = "", palette = "Set2",
labels = c("Daily doses","7-day rolling average")) +
ylim(0L, 170000L)
doses[DATE >= ymd("20210501")] |>
select("DATE", "NET", "NET7") |>
melt(id.var = "DATE") |>
ggplot(aes(x = DATE, y = value, color = variable)) +
geom_line(size = 1) +
scale_y_continuous(label=comma) +
labs(x = "Date", y = "Doses", color = " ") +
theme(legend.position = "bottom") +
scale_color_brewer(name = "", palette = "Set2",
labels = c("Daily doses","7-day rolling average")) +
ylim(0L, 170000L)
doses[DATE >= ymd("20210501")] |>
select("DATE", "NET", "NET7") |>
melt(id.var = "DATE") |>
ggplot(aes(x = DATE, y = value, color = variable)) +
geom_line(size = 1) +
scale_y_continuous(label=scales::comma) +
labs(x = "Date", y = "Doses", color = " ") +
theme(legend.position = "bottom") +
scale_color_brewer(name = "", palette = "Set2",
labels = c("Daily doses","7-day rolling average")) +
ylim(0L, 170000L)
doses[DATE >= ymd("20210501")] |>
select("DATE", "NET", "NET7") |>
melt(id.var = "DATE") |>
ggplot(aes(x = DATE, y = value, color = variable)) +
geom_line(size = 1) +
labs(x = "Date", y = "Doses", color = " ") +
theme(legend.position = "bottom") +
scale_color_brewer(name = "", palette = "Set2",
labels = c("Daily doses","7-day rolling average")) +
ylim(0L, 170000L)
require(ggplot2)
require(rvest)
require(data.table)
require(lubridate)
require(ggplot2)
require(ggthemr)
doses <- "https://covidlive.com.au/report/daily-vaccinations/aus" |>
read_html() |>
html_table()
doses <- doses[[2]] |>
data.table()
doses[, `:=`(DATE = dmy(DATE), DOSES = as.numeric(gsub(",", "", DOSES)), NET = as.numeric(gsub(",", "", NET)))]
setkey(doses, DATE)
doses[, DOSES7 := frollmean(DOSES, 7, algo = "exact")]
doses[, NET7 := frollmean(NET, 7, algo = "exact")]
### set theme
ggthemr("dust")
doses[DATE >= ymd("20210501")] |>
select("DATE", "NET", "NET7") |>
melt(id.var = "DATE") |>
ggplot(aes(x = DATE, y = value, color = variable)) +
geom_line(size = 1) +
labs(x = "Date", y = "Doses", color = " ") +
theme(legend.position = "bottom") +
scale_color_brewer(name = "", palette = "Set2",
labels = c("Daily doses","7-day rolling average")) +
ylim(0L, 170000L)
start_QTR <- "2018Q4"
end_QTR <- "2018Q4"
out_dir <- "/Users/evolkova/Documents/Blocks/"
################################################################################
####################### construct SEC master file ##############################
################################################################################
qtr.master.file <- function(date) {
require(data.table)
require(dplyr)
require(Hmisc)
require(httr)
master.link <- paste0("https://www.sec.gov/Archives/edgar/full-index/", year(date), "/QTR", quarter(date), "/master.idx")
print(sprintf("Downloading master file for quarter %d of year %s...", quarter(date), year(date)))
download.file(master.link, paste0(out_dir, "tmp.txt"), method = "curl")
master <- paste0(out_dir, "tmp.txt") %>%
readLines() %>%
gsub("#", "", .) %>%
paste0(collapse = "\n") %>%
fread(sep = "|", skip = 11) %>%
`colnames<-`(c("cik", "name", "type", "date", "link")) %>%
filter(grepl("SC 13(D|G)", type)) %>%
mutate(link = paste0("https://www.sec.gov/Archives/", link)) %>%
mutate(file = gsub(".*/", "", link))
closeAllConnections()
file.remove(paste0(out_dir, "tmp.txt"))
return(master)
}
get_dates <- function(start_QTR, end_QTR) {
require(data.table)
require(zoo)
require(lubridate)
require(dplyr)
end_QTR <- end_QTR %>%
as.yearqtr("%YQ%q") %>%
as.Date()
all_dates <- start_QTR %>%
as.yearqtr("%YQ%q") %>%
as.Date()
while (all_dates[length(all_dates)] < ymd(end_QTR))
all_dates <- c(all_dates, all_dates[length(all_dates)]  %m+% months(3))
return(all_dates)
}
i <-
1
print(Sys.time())
master <- qtr.master.file(dates[i])
dates <- get_dates(start_QTR, end_QTR)
master <- qtr.master.file(dates[i])
x <- readRDS("/Users/evolkova/Dropbox/DataY/DB/NETS2014_Ratings.rds")
master.link <- paste0("https://www.sec.gov/Archives/edgar/full-index/", year(date), "/QTR", quarter(date), "/master.idx")
date <- dates[1]
maste r.link <- paste0("https://www.sec.gov/Archives/edgar/full-index/", year(date), "/QTR", quarter(date), "/master.idx")
print(sprintf("Downloading master file for quarter %d of year %s...", quarter(date), year(date)))
master.link <- paste0("https://www.sec.gov/Archives/edgar/full-index/", year(date), "/QTR", quarter(date), "/master.idx")
print(sprintf("Downloading master file for quarter %d of year %s...", quarter(date), year(date)))
download.file(master.link, paste0(out_dir, "tmp.txt"), method = "curl",
headers = c("User-Agent" = "Ekaterina Volkova orhahogt@gmail.com"))
master <- paste0(out_dir, "tmp.txt") %>%
readLines() %>%
gsub("#", "", .) %>%
paste0(collapse = "\n") %>%
fread(sep = "|", skip = 11) %>%
`colnames<-`(c("cik", "name", "type", "date", "link")) %>%
filter(grepl("SC 13(D|G)", type)) %>%
mutate(link = paste0("https://www.sec.gov/Archives/", link)) %>%
mutate(file = gsub(".*/", "", link))
head(master)
dwnld.files <- function(master, delay = T) {
require(RCurl)
dir.create("temp_dir")
master <- master[!duplicated(file)]
for (j in 1:length(master$file)) {
if (delay == T) Sys.sleep(0.13)
file_name <- paste0(out_dir,"./temp_dir/", master$file[j])
#file <- master$link[j] %>%
#  getURL() %>%
#  try()
download.file(master$link[j], file_name, method = "curl",
headers = c("User-Agent" = "Ekaterina Volkova orhahog@gmail.com"))
#write(file, file_name)
}
}
print(Sys.time())
master <- qtr.master.file(dates[i])
qtr.master.file <- function(date) {
require(data.table)
require(dplyr)
require(Hmisc)
require(httr)
master.link <- paste0("https://www.sec.gov/Archives/edgar/full-index/", year(date), "/QTR", quarter(date), "/master.idx")
print(sprintf("Downloading master file for quarter %d of year %s...", quarter(date), year(date)))
download.file(master.link, paste0(out_dir, "tmp.txt"), method = "curl",
headers = c("User-Agent" = "Ekaterina Volkova orhahog@gmail.com"))
master <- paste0(out_dir, "tmp.txt") %>%
readLines() %>%
gsub("#", "", .) %>%
paste0(collapse = "\n") %>%
fread(sep = "|", skip = 11) %>%
`colnames<-`(c("cik", "name", "type", "date", "link")) %>%
filter(grepl("SC 13(D|G)", type)) %>%
mutate(link = paste0("https://www.sec.gov/Archives/", link)) %>%
mutate(file = gsub(".*/", "", link))
closeAllConnections()
file.remove(paste0(out_dir, "tmp.txt"))
return(master)
}
################################################################################
####################download files into tmp dir ################################
################################################################################
### sometimes the SEC puts a limit on the number of downloads
### put delay = T to account for that
dwnld.files <- function(master, delay = T) {
require(RCurl)
dir.create("temp_dir")
master <- master[!duplicated(file)]
for (j in 1:length(master$file)) {
if (delay == T) Sys.sleep(0.13)
file_name <- paste0(out_dir,"./temp_dir/", master$file[j])
#file <- master$link[j] %>%
#  getURL() %>%
#  try()
download.file(master$link[j], file_name, method = "curl",
headers = c("User-Agent" = "Ekaterina Volkova orhahog@gmail.com"))
#write(file, file_name)
}
}
print(Sys.time())
master <- qtr.master.file(dates[i])
date
master.link <- paste0("https://www.sec.gov/Archives/edgar/full-index/", year(date), "/QTR", quarter(date), "/master.idx")
print(sprintf("Downloading master file for quarter %d of year %s...", quarter(date), year(date)))
download.file(master.link, paste0(out_dir, "tmp.txt"), method = "curl",
headers = c("User-Agent" = "Ekaterina Volkova orhahog@gmail.com"))
master <- paste0(out_dir, "tmp.txt") %>%
readLines() %>%
gsub("#", "", .) %>%
paste0(collapse = "\n") %>%
fread(sep = "|", skip = 11) %>%
`colnames<-`(c("cik", "name", "type", "date", "link")) %>%
filter(grepl("SC 13(D|G)", type)) %>%
mutate(link = paste0("https://www.sec.gov/Archives/", link)) %>%
mutate(file = gsub(".*/", "", link))
closeAllConnections()
qtr.master.file <- function(date) {
require(data.table)
require(dplyr)
require(Hmisc)
require(httr)
master.link <- paste0("https://www.sec.gov/Archives/edgar/full-index/", year(date), "/QTR", quarter(date), "/master.idx")
print(sprintf("Downloading master file for quarter %d of year %s...", quarter(date), year(date)))
download.file(master.link, paste0(out_dir, "tmp.txt"), method = "curl",
headers = c("User-Agent" = "Ekaterina Volkova orhahog@gmail.com"))
master <- paste0(out_dir, "tmp.txt") %>%
readLines() %>%
gsub("#", "", .) %>%
paste0(collapse = "\n") %>%
fread(sep = "|", skip = 11) %>%
`colnames<-`(c("cik", "name", "type", "date", "link")) %>%
filter(grepl("SC 13(D|G)", type)) %>%
mutate(link = paste0("https://www.sec.gov/Archives/", link)) %>%
mutate(file = gsub(".*/", "", link))
closeAllConnections()
file.remove(paste0(out_dir, "tmp.txt"))
return(master)
}
master <- qtr.master.file(dates[i])
date <- dates[i]
master <- qtr.master.file(date)
qtr.master.file <- function(date) {
require(data.table)
require(dplyr)
require(Hmisc)
require(httr)
master.link <- paste0("https://www.sec.gov/Archives/edgar/full-index/", year(date), "/QTR", quarter(date), "/master.idx")
print(sprintf("Downloading master file for quarter %d of year %s...", quarter(date), year(date)))
download.file(master.link, paste0(out_dir, "tmp.txt"), method = "curl",
headers = c("User-Agent" = "Ekaterina Volkova orhahog@gmail.com"))
master <- paste0(out_dir, "tmp.txt") %>%
readLines() %>%
gsub("#", "", .) %>%
paste0(collapse = "\n") %>%
fread(sep = "|", skip = 11) %>%
`colnames<-`(c("cik", "name", "type", "date", "link")) %>%
filter(grepl("SC 13(D|G)", type)) %>%
mutate(link = paste0("https://www.sec.gov/Archives/", link)) %>%
mutate(file = gsub(".*/", "", link))
closeAllConnections()
file.remove(paste0(out_dir, "tmp.txt"))
return(master)
}
master <- qtr.master.file(dates[i])
require(ggplot2)
require(rvest)
require(data.table)
require(lubridate)
require(ggplot2)
require(ggthemr)
doses <- "https://covidlive.com.au/report/daily-vaccinations/aus" |>
read_html() |>
html_table()
doses <- doses[[2]] |>
data.table()
doses[, `:=`(DATE = dmy(DATE), DOSES = as.numeric(gsub(",", "", DOSES)), NET = as.numeric(gsub(",", "", NET)))]
setkey(doses, DATE)
doses[, DOSES7 := frollmean(DOSES, 7, algo = "exact")]
doses[, NET7 := frollmean(NET, 7, algo = "exact")]
### set theme
ggthemr("dust")
doses[DATE >= ymd("20210501")] |>
select("DATE", "NET", "NET7") |>
melt(id.var = "DATE") |>
ggplot(aes(x = DATE, y = value, color = variable)) +
geom_line(size = 1) +
labs(x = "Date", y = "Doses", color = " ") +
theme(legend.position = "bottom") +
scale_color_brewer(name = "", palette = "Set2",
labels = c("Daily doses","7-day rolling average")) +
ylim(0L, 170000L)
